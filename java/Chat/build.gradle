buildscript {
    repositories {
        maven { url 'https://repo.zeroc.com/nexus/content/repositories/thirdparty' }
        maven { url 'http://repo.zeroc.com/nexus/content/repositories/releases' }
    }
    dependencies {
        classpath group: 'net.sourceforge', name: 'proguard', version: '5.0'
    }
}

slice {
    java {
        include = ["${projectDir}"]
        srcDir = '.'
    }
}

sourceSets {
    main {
        java {
            srcDir 'src'
        }
    }
}

dependencies {
    compile 'com.jgoodies:jgoodies-common:1.8.0'
    compile 'com.jgoodies:jgoodies-looks:2.6.0'
    compile 'com.jgoodies:jgoodies-forms:1.8.0'
    compile 'com.zeroc:ice:3.6b'
    compile 'com.zeroc:glacier2:3.6b'
}

jar {
    archiveName = "ChatGUI.jar"
    manifest {
        attributes 'Main-Class': "ChatDemoGUI.MainView"
    }
}

def javaHome = System.properties['java.home']

task proguard(type: proguard.gradle.ProGuardTask, dependsOn: jar) {
    injars configurations.compile.resolve(), filter: '!META-INF/**'
    injars "${projectDir}/build/libs/ChatGUI.jar"
    libraryjars "${javaHome}/lib/rt.jar"
    libraryjars "${javaHome}/lib/jsse.jar"
    outjars "ChatGUI.jar"
    configuration "chatdemogui.pro"
}
assemble.dependsOn(proguard)

clean {
    delete("ChatGUI.jar")
}
